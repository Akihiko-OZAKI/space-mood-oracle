# ✅ 本番環境セットアップ - チェックリスト

## 📋 前提条件

- [ ] GitHubリポジトリにプロジェクトがプッシュされている
- [ ] ブランチ名を確認（`main` または `master`）

---

## 🌍 ステップ1: PlanetScale（データベース）

### アカウント作成

- [ ] https://planetscale.com/ にアクセス
- [ ] 「Sign up」でアカウント作成
- [ ] 無料プラン（Hobby）を選択

### データベース作成

- [ ] 「Create database」をクリック
- [ ] データベース名: `space_mood_oracle`
- [ ] リージョン: 日本に近いものを選択
- [ ] プラン: `Hobby`（無料）
- [ ] 「Create database」をクリック

### 接続情報を取得

- [ ] データベースを開く
- [ ] 「Connect」ボタンをクリック
- [ ] 「General」を選択
- [ ] **接続文字列をコピー**（後で使います）

**接続文字列の形式:**
```
mysql://username:password@host.planetscale.com:3306/database?sslaccept=strict
```

### SQL実行（テーブル作成）

- [ ] データベースを開く
- [ ] 「Branches」タブ → 「main」ブランチを選択
- [ ] 「Console」タブを開く
- [ ] `【今すぐ実行】DB作成.sql` の内容をコピー
- [ ] SQLエディタにペースト
- [ ] 「Run」をクリック
- [ ] エラーがなければ成功 ✅

### 確認

- [ ] 「Tables」タブでテーブルが表示されることを確認
- [ ] 以下の3つのテーブルが表示される:
  - `google_trend_data`
  - `twitter_trend_data`
  - `daily_mood_judgment`

---

## 🚀 ステップ2: Render（アプリホスティング）

### アカウント作成

- [ ] https://render.com/ にアクセス
- [ ] 「Get Started for Free」をクリック
- [ ] GitHubアカウントでログイン（推奨）

### リポジトリ連携

- [ ] GitHubアカウントを認証
- [ ] リポジトリを選択: `space-mood-oracle`（プロジェクト名）

### Webサービス作成

- [ ] 「New +」→「Web Service」を選択
- [ ] サービス設定を入力:

  | 項目 | 値 |
  |------|-----|
  | **Name** | `space-mood-oracle` |
  | **Region** | `Oregon (US West)` など |
  | **Branch** | `main` |
  | **Root Directory** | `space_mood_oracle_v2.1/space_mood_oracle` |
  | **Runtime** | `Node` |
  | **Build Command** | `pnpm install && pnpm build` |
  | **Start Command** | `pnpm start` |
  | **Instance Type** | `Free` |

### 環境変数設定

- [ ] 「Environment」セクションを開く
- [ ] 以下の環境変数を追加:

  ```env
  DATABASE_URL=mysql://username:password@host.planetscale.com:3306/database?sslaccept=strict
  JWT_SECRET=your-random-secret-key-change-this-in-production
  NODE_ENV=production
  PORT=10000
  ```

  **重要:**
  - `DATABASE_URL`: PlanetScaleから取得した接続文字列をそのまま使用
  - `JWT_SECRET`: ランダムな文字列に変更（例: `openssl rand -hex 32`）

- [ ] 「Create Web Service」をクリック

### デプロイ待機

- [ ] デプロイが開始される（約5-10分）
- [ ] ログでビルド状況を確認
- [ ] 「Live」と表示されれば成功 ✅

### 動作確認

- [ ] デプロイが完了したら、URLにアクセス
- [ ] アプリが正常に表示されることを確認
- [ ] エラーがないことを確認

---

## 🔧 トラブルシューティング

### PlanetScale

**問題**: SQL実行エラー
- [ ] SQLファイルの内容を確認
- [ ] エラーメッセージを確認
- [ ] データベースが選択されているか確認

**問題**: 接続文字列が取得できない
- [ ] データベースの「Connect」ボタンから取得
- [ ] 「General」を選択

### Render

**問題**: ビルドエラー
- [ ] ログを確認
- [ ] `package.json` のビルドスクリプトを確認
- [ ] 依存関係を確認

**問題**: 起動エラー
- [ ] 環境変数を確認
- [ ] データベース接続を確認
- [ ] ポート設定を確認（`PORT=10000`）

**問題**: データベース接続エラー
- [ ] `DATABASE_URL` を確認
- [ ] PlanetScaleの接続文字列を確認
- [ ] SSL設定を確認（`?sslaccept=strict`）

---

## 📚 参考ドキュメント

- **詳細ガイド**: `【START_HERE】本番環境セットアップ.md`
- **PlanetScale詳細**: `PlanetScale_セットアップガイド.md`
- **Render詳細**: `Render_デプロイガイド.md`
- **SQLファイル**: `【今すぐ実行】DB作成.sql`

---

## 🎯 完了後

- [ ] アプリにアクセスして動作確認
- [ ] データベース接続を確認
- [ ] APIエンドポイントをテスト
- [ ] （オプション）UptimeRobotでPing設定（スリープ回避）

---

## 💰 コスト

**合計: $0/月（完全無料）** ✅

- PlanetScale: 無料（期限なし）
- Render: 無料（スリープあり）

---

**チェックリストを全て完了すれば、本番環境が完成です！** 🎉

