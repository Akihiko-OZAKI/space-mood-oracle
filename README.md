# 宇宙の意思 (Cosmic Will) - 人類の集合意識を読み解く

太陽フレアや地磁気嵐などの宇宙天気データと、X（Twitter）の集合感情を結びつける、新しいタイプの意識分析アプリケーションです。

## 概要

「宇宙の意思」は、個人の運勢ではなく、**人類全体の集合意識**を可視化します。宇宙からのエネルギーが、地球上の人々の心にどのように響くかを、データを通じて読み解きます。

### コンセプト

このアプリは、以下の2つのフェーズで動作します：

**フェーズ1: 初期構築（1回のみ）**
- 過去データ（宇宙データ + Tweetデータ）をロード
- 相関分析を実行してモデルを構築
- 「宇宙天気 → 集合感情」の関係性を学習

**フェーズ2: 日常運用**
- その日の宇宙データのみを取得
- 学習済みモデルで「今日の集合感情」を推論
- 「今日の宇宙の意思」として表示

## 主な機能

### データ収集
- **宇宙天気データ取得**: NOAA（米国海洋大気庁）と京都大学からの実際の宇宙天気データ（完全無料）
  - 太陽フレア（X/M/Cクラス）
  - Kp指数（地磁気活動）
  - 太陽風速度
  - プロトンフラックス
- **CSVアップロード**: ツイートデータのCSVファイルをアップロードして分析
  - Pushshift Torrent形式対応
  - Twitter API形式対応
  - カスタムCSV対応（date, textカラム必須）
- **サンプルデータ生成**: デモ用の疑似データ生成（過去90日分）

### 分析機能
- **感情分析**: 多言語感情辞書を使用したツイートの感情分析
  - 81言語対応
  - 日本語強化（東北大学辞書）
- **バッチ処理**: 大量のツイートを効率的に分析
- **相関分析**: 宇宙天気と感情スコアの相関関係を分析
- **予測モデル**: 機械学習を使用した感情予測

### 可視化
- **インタラクティブグラフ**: Rechartsを使用した美しいチャート
  - 感情スコアトレンド（過去30日）
  - 宇宙天気と感情の相関チャート
  - 投稿数トレンド
- **宇宙テーマのUI**: 神秘的なダークモードデザイン
- **リアルタイム更新**: 最新の宇宙天気データを自動取得

## 技術スタック

### バックエンド
- **Node.js** + **TypeScript**
- **tRPC**: 型安全なAPI通信
- **Express**: Webサーバー
- **Drizzle ORM**: データベース管理
- **MySQL/TiDB**: データストレージ

### フロントエンド
- **React 19**: UIフレームワーク
- **Tailwind CSS 4**: スタイリング
- **shadcn/ui**: UIコンポーネント
- **Recharts**: データ可視化

### AI/機械学習
- **感情分析エンジン**: 多言語辞書ベース
- **予測モデル**: 相関分析と線形回帰
- **データソース**: NOAA、京都大学WDC（完全無料）

## データベーススキーマ

### `daily_sentiment_scores`
日次の感情スコアを保存
- `date`: 日付（YYYY-MM-DD）
- `score`: 感情スコア（-1.0〜1.0）
- `tweetCount`: 分析したツイート数
- `positiveCount`, `negativeCount`, `neutralCount`: 感情分類カウント

### `space_weather_data`
宇宙天気データを保存
- `date`: 日付（YYYY-MM-DD）
- `kpIndexMax`: 最大Kp指数
- `xClassFlareCount`, `mClassFlareCount`: フレア発生回数
- `solarWindSpeed`: 太陽風速度
- `protonFlux`: プロトンフラックス

### `predictions`
予測結果を保存
- `date`: 予測対象日
- `predictedScore`: 予測感情スコア
- `confidence`: 信頼度（0.0〜1.0）
- `modelVersion`: モデルバージョン

## API エンドポイント

### 感情分析 (`sentiment`)
- `analyze`: テキストの感情分析
- `getDailyScores`: 日次スコアの取得
- `getScoreByDate`: 特定日のスコア取得
- `uploadDailyScore`: スコアのアップロード（認証必要）

### 宇宙天気 (`spaceWeather`)
- `getData`: 宇宙天気データの取得
- `getDataByDate`: 特定日のデータ取得
- `fetchRealData`: 実際のNOAAデータ取得（認証必要）
- `generateMockData`: サンプルデータ生成（認証必要）

### ツイートアップロード (`tweetUpload`)
- `uploadCSV`: CSVファイルをアップロードして感情分析（認証必要）

### 予測 (`predictions`)
- `getLatest`: 最新の予測結果
- `getByDate`: 特定日の予測結果

### 占い (`oracle`)
- `getTodayFortune`: 今日の集合意識
- `getFortuneByDate`: 特定日の集合意識

## セットアップ

### 必要な環境変数
プロジェクトは自動的に以下の環境変数を使用します：
- `DATABASE_URL`: データベース接続文字列
- `JWT_SECRET`: セッション署名用シークレット
- その他のManus組み込み環境変数

### インストールと起動

```bash
# 依存関係のインストール
pnpm install

# データベースマイグレーション
pnpm db:push

# 開発サーバー起動
pnpm dev

# 本番ビルド
pnpm build

# 本番サーバー起動
pnpm start

# テスト実行
pnpm test
```

## 使い方

### 初回セットアップ

1. **サンプルデータで試す**
   - 「サンプル生成」ボタンをクリック
   - 過去90日分の疑似データが生成されます

2. **実際の宇宙天気データを取得**
   - 「実データ取得」ボタンをクリック
   - NOAAから過去30日分の実データを取得

3. **ツイートデータをアップロード**
   - CSVファイルを準備（date, textカラム必須）
   - 「ツイートデータアップロード」セクションからアップロード
   - 自動的に感情分析が実行されます

### 日常の使用

- アプリを開くと、今日の集合意識が表示されます
- 宇宙天気データは自動的に最新のものが取得されます
- グラフで過去のトレンドを確認できます

## データソース

### 宇宙天気データ（完全無料）
- **NOAA Space Weather Prediction Center**
  - 太陽フレアデータ: https://services.swpc.noaa.gov/json/edited_events.json
  - Kp指数データ: https://services.swpc.noaa.gov/json/planetary_k_index_1m.json
- **京都大学 World Data Center for Geomagnetism**
  - Kp指数データ: https://wdc.kugi.kyoto-u.ac.jp/

### 感情分析
- **多言語感情辞書**: 81言語対応の感情極性辞書
- **日本語強化**: 東北大学日本語感情極性辞書

### ツイートデータ
- **Pushshift Torrent**: 2023〜2025年のTwitterデータ（要ダウンロード）
- **カスタムCSV**: 独自のツイートデータ

## テスト

プロジェクトには包括的なテストスイートが含まれています：

```bash
# 全テスト実行
pnpm test

# ウォッチモード
pnpm test --watch
```

### テストカバレッジ
- 感情分析エンジン: 9テスト
- 予測モデル: 10テスト
- CSVアップロード: 10テスト
- 認証システム: 1テスト
- **合計: 30テスト（全てパス）**

## 今後の拡張予定

- [ ] より高度な機械学習モデル（LightGBM/XGBoost）
- [ ] リアルタイムデータストリーミング
- [ ] 日付指定での過去/未来の集合意識表示
- [ ] 多言語UI対応
- [ ] 通知機能

## ライセンス

MIT License

## 貢献

プルリクエストを歓迎します！

## サポート

問題や質問がある場合は、GitHubのIssuesセクションで報告してください。

---

**宇宙の意思 (Cosmic Will)** - 宇宙と人類の集合意識を繋ぐ
