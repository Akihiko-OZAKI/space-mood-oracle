# 🚀 Render デプロイ完全ガイド

## 📋 概要

Renderは、**完全無料でフルスタックアプリをデプロイできる**クラウドホスティングサービスです。

---

## 🎯 なぜ Render か？

1. ✅ **完全無料**（Webサービス無料プラン）
2. ✅ **フルスタック対応**（React + Express）
3. ✅ **GitHub連携**（自動デプロイ）
4. ✅ **HTTPS自動対応**
5. ✅ **セットアップが簡単**

---

## 📥 ステップ1: Renderアカウント作成

### 1. Renderにアクセス

- サイト: https://render.com/
- 「Get Started for Free」をクリック

### 2. アカウント作成

- **GitHubアカウントでログイン**（推奨）
  - GitHubとの連携が簡単
  - リポジトリへの自動アクセス

- または、メールアドレスで登録

### 3. プラン選択

- **「Free」プラン**を選択（無料）
- 必要情報を入力して完了

---

## 📦 ステップ2: GitHubリポジトリの準備

### 1. リポジトリを確認

- GitHubにプロジェクトがプッシュされているか確認
- ブランチ名を確認（通常は `main` または `master`）

### 2. 必要ファイルの確認

プロジェクトに以下があることを確認:

- ✅ `package.json`
- ✅ `pnpm-lock.yaml`（または `package-lock.json`）
- ✅ ビルドスクリプト（`"build"`）
- ✅ 起動スクリプト（`"start"`）

---

## 🚀 ステップ3: Webサービスを作成

### 1. 新しいサービスを作成

1. Renderダッシュボードで「**New +**」をクリック
2. 「**Web Service**」を選択

### 2. リポジトリを接続

1. 「**Connect account**」または「**Connect GitHub**」をクリック
2. GitHubアカウントを認証
3. リポジトリを選択: `space-mood-oracle`（またはプロジェクト名）

### 3. サービス設定

以下の設定を入力:

| 項目 | 値 | 説明 |
|------|-----|------|
| **Name** | `space-mood-oracle` | サービス名（任意） |
| **Region** | `Oregon (US West)` | 日本に近いリージョン |
| **Branch** | `main` | デプロイするブランチ |
| **Root Directory** | `space_mood_oracle_v2.1/space_mood_oracle` | プロジェクトルート |
| **Runtime** | `Node` | Node.js |
| **Build Command** | `pnpm install && pnpm build` | ビルドコマンド |
| **Start Command** | `pnpm start` | 起動コマンド |
| **Instance Type** | `Free` | 無料プラン |

**重要な設定:**

- **Root Directory**: プロジェクトがサブディレクトリにある場合、ここを指定
- **Build Command**: `pnpm install && pnpm build`
- **Start Command**: `pnpm start`

### 4. 環境変数を設定

「**Environment**」セクションで、以下の環境変数を追加:

```env
DATABASE_URL=mysql://username:password@host.planetscale.com:3306/database?sslaccept=strict
JWT_SECRET=your-random-secret-key-change-this-in-production
NODE_ENV=production
PORT=10000
```

**各環境変数の説明:**

- `DATABASE_URL`: PlanetScaleから取得した接続文字列
- `JWT_SECRET`: ランダムな文字列（本番環境用）
- `NODE_ENV`: `production`
- `PORT`: Renderが自動設定するポート（通常は `10000`）

### 5. サービスを作成

- 「**Create Web Service**」をクリック
- デプロイが自動的に開始されます ✅

---

## ⏳ ステップ4: デプロイ待機

### デプロイプロセス

1. **依存関係のインストール**（約2-3分）
   - `pnpm install` が実行される

2. **ビルド**（約3-5分）
   - `pnpm build` が実行される
   - ReactとExpressがビルドされる

3. **起動**（約1分）
   - `pnpm start` が実行される
   - アプリが起動する

**初回デプロイは約5-10分かかります** ⏱️

### ログの確認

- デプロイ中はログがリアルタイムで表示されます
- エラーがあればログに表示されます

---

## ✅ ステップ5: 確認

### 1. デプロイ成功の確認

- ダッシュボードで「**Live**」と表示されれば成功 ✅
- URLが表示されます（例: `https://space-mood-oracle.onrender.com`）

### 2. アプリにアクセス

- URLをクリックしてアプリにアクセス
- 正常に表示されれば成功 ✅

### 3. エラーが発生した場合

**よくあるエラー:**

1. **ビルドエラー**
   - ログを確認
   - 依存関係の問題を確認

2. **起動エラー**
   - 環境変数を確認
   - データベース接続を確認

3. **ポートエラー**
   - `PORT` 環境変数が正しいか確認

---

## 🔄 ステップ6: 自動デプロイの設定

### GitHub連携（自動デプロイ）

デフォルトで、GitHubにプッシュすると自動デプロイされます:

1. **GitHubにプッシュ**
   ```bash
   git push origin main
   ```

2. **Renderが自動検知**
   - 新しいデプロイが開始されます

3. **デプロイ完了**
   - 約5-10分でデプロイ完了

### 手動デプロイ

- ダッシュボードで「**Manual Deploy**」をクリック

---

## ⚙️ ステップ7: 環境変数の更新

### 環境変数を追加/変更

1. ダッシュボードでサービスを開く
2. 「**Environment**」タブを開く
3. 環境変数を追加/編集
4. 「**Save Changes**」をクリック
5. 自動的に再デプロイされます

---

## 🔒 ステップ8: カスタムドメイン（オプション）

### カスタムドメインの追加

1. ダッシュボードでサービスを開く
2. 「**Settings**」タブを開く
3. 「**Custom Domains**」セクションを開く
4. ドメインを追加
5. DNS設定を追加（指示に従う）

**無料プランでもカスタムドメインは可能** ✅

---

## ⚠️ 無料プランの制限

### スリープ機能

- **15分間アクセスがないとスリープ**
- **初回アクセス時に約30秒かかる**（起動時間）

### スリープを回避する方法

1. **UptimeRobot（無料）で定期Ping**
   - https://uptimerobot.com/
   - 5分ごとにPingを送信

2. **有料プランにアップグレード**
   - $7/月でスリープなし

**小規模アプリなら無料プランで十分** ✅

---

## 🆘 トラブルシューティング

### デプロイエラー

**エラー**: "Build failed"

**解決策:**
- ログを確認
- `package.json` のビルドスクリプトを確認
- 依存関係を確認

### 起動エラー

**エラー**: "Application failed to start"

**解決策:**
- 環境変数を確認
- データベース接続を確認
- ポート設定を確認

### データベース接続エラー

**エラー**: "Cannot connect to database"

**解決策:**
- `DATABASE_URL` を確認
- PlanetScaleの接続文字列を確認
- SSL設定を確認（`?sslaccept=strict`）

---

## 📊 デプロイ後の構成

```
┌─────────────────────────────────────┐
│  ユーザー（ブラウザ）                │
│  https://space-mood-oracle.onrender.com │
└──────────────┬──────────────────────┘
               │
               ▼
┌─────────────────────────────────────┐
│  Render（Webサービス）               │
│  - React フロントエンド              │
│  - Express バックエンド              │
│  - tRPC API                         │
│  - HTTPS自動対応                     │
└──────────────┬──────────────────────┘
               │
               ▼
┌─────────────────────────────────────┐
│  PlanetScale（データベース）         │
│  - MySQL互換                         │
│  - 完全無料                          │
│  - 自動スケーリング                  │
└─────────────────────────────────────┘
```

---

## 📝 まとめ

### セットアップ手順

1. ✅ Renderアカウント作成
2. ✅ GitHubリポジトリを接続
3. ✅ Webサービスを作成
4. ✅ 環境変数を設定
5. ✅ デプロイ待機（約5-10分）
6. ✅ 動作確認

### 所要時間

- アカウント作成: 約2分
- サービス作成: 約5分
- デプロイ待機: 約5-10分

**合計: 約15分** ⏱️

---

## 🎯 次のステップ

デプロイ完了後:

1. ✅ アプリにアクセスして動作確認
2. ✅ データベース接続を確認
3. ✅ APIエンドポイントをテスト
4. ✅ （オプション）UptimeRobotでPing設定

---

**Renderでアプリをデプロイしましょう！** 🚀

詳細: https://render.com/


