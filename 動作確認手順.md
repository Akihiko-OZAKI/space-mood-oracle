# 🧪 動作確認手順

## 前提条件

1. ✅ マイグレーションが実行済み（3つのテーブルが作成されている）
2. ✅ データベース接続が正常
3. ✅ サーバーが起動できる状態

---

## ステップ1: マイグレーション確認

データベースで以下のSQLを実行して、テーブルが作成されているか確認：

```sql
SHOW TABLES LIKE '%trend%';
SHOW TABLES LIKE '%mood%';
```

**期待される結果:**
- `google_trend_data`
- `twitter_trend_data`
- `daily_mood_judgment`

---

## ステップ2: サーバー起動

```bash
pnpm dev
# または
npm run dev
```

サーバーが `http://localhost:3000` で起動することを確認。

---

## ステップ3: APIテスト

### 方法1: ブラウザの開発者ツールでテスト

1. ブラウザで `http://localhost:3000` を開く
2. 開発者ツール（F12）を開く
3. Consoleタブで以下を実行：

```javascript
// 今日の判定を取得
fetch('/api/trpc/trends.getTodayMood')
  .then(r => r.json())
  .then(data => {
    console.log('✅ API Response:', data);
  })
  .catch(err => {
    console.error('❌ Error:', err);
  });
```

### 方法2: curlコマンドでテスト

```bash
# 今日の判定を取得
curl http://localhost:3000/api/trpc/trends.getTodayMood

# 指定日の判定を取得
curl "http://localhost:3000/api/trpc/trends.getMoodByDate?input=%7B%22date%22%3A%222025-01-30%22%7D"
```

### 方法3: Postmanでテスト

1. Postmanを開く
2. GETリクエストを作成
3. URL: `http://localhost:3000/api/trpc/trends.getTodayMood`
4. Sendボタンをクリック

---

## ステップ4: 期待される結果

### 成功レスポンス例

```json
{
  "result": {
    "data": {
      "success": true,
      "judgment": {
        "judgment": "good",
        "score": 0.45,
        "confidence": 0.8,
        "breakdown": {
          "google": 0.3,
          "twitter": 0.5,
          "space": -0.2
        },
        "explanation": "今日は良い日です。世の中の雰囲気がポジティブで、宇宙からの影響も穏やかです。",
        "date": "2025-01-30",
        "trendData": {
          "google": { ... },
          "twitter": { ... },
          "spaceWeather": { ... }
        }
      }
    }
  }
}
```

### エラーレスポンスの場合

```json
{
  "error": {
    "message": "Table 'database.google_trend_data' doesn't exist"
  }
}
```

→ マイグレーションが未実行です。SQLファイルを実行してください。

---

## ステップ5: 各エンドポイントのテスト

### 1. 今日の判定取得

```bash
GET /api/trpc/trends.getTodayMood
```

### 2. 指定日の判定取得

```bash
GET /api/trpc/trends.getMoodByDate?input={"date":"2025-01-30"}
```

### 3. Googleトレンドデータ取得

```bash
GET /api/trpc/trends.getGoogleTrends?input={"date":"2025-01-30"}
```

### 4. Twitterトレンドデータ取得

```bash
GET /api/trpc/trends.getTwitterTrends?input={"date":"2025-01-30"}
```

### 5. 期間内の判定一覧取得

```bash
GET /api/trpc/trends.getMoodJudgments?input={"startDate":"2025-01-01","endDate":"2025-01-30"}
```

---

## トラブルシューティング

### エラー: "Table doesn't exist"

**原因**: マイグレーションが未実行

**解決策**: 
1. `drizzle/0003_trend_analysis_tables.sql` のSQLをデータベースで実行
2. テーブルが作成されたことを確認

### エラー: "DATABASE_URL is not set"

**原因**: 環境変数が設定されていない

**解決策**: 
1. `.env` ファイルを作成
2. `DATABASE_URL=mysql://user:password@host:port/database` を追加

### エラー: "Cannot connect to database"

**原因**: データベース接続設定が間違っている

**解決策**: 
1. `DATABASE_URL` を確認
2. データベースサーバーが起動しているか確認
3. ユーザー名・パスワード・ホストが正しいか確認

### APIが404を返す

**原因**: ルーティング設定の問題

**解決策**: 
1. サーバーが正しく起動しているか確認
2. tRPCのエンドポイントパスを確認
3. ログでエラーがないか確認

---

## ✅ 動作確認チェックリスト

- [ ] マイグレーション実行済み
- [ ] テーブルが作成されていることを確認
- [ ] サーバーが起動している
- [ ] `trends.getTodayMood` APIが正常に動作
- [ ] 判定結果が正しく返される
- [ ] エラーが発生しない

---

## 📝 テスト結果記録

テスト日時: _______________

結果:
- [ ] 成功
- [ ] 失敗（エラー内容: __________________）

次のステップ: ___________________

---

以上で動作確認は完了です！

