# マイグレーション手動実行手順

## 📋 概要

マイグレーションファイル `drizzle/0003_trend_analysis_tables.sql` をデータベースで実行して、新しいテーブルを作成します。

---

## 🎯 実行方法

### 方法1: データベース管理ツールで実行（推奨）

#### phpMyAdmin の場合

1. phpMyAdminにログイン
2. データベースを選択
3. 「SQL」タブをクリック
4. `drizzle/0003_trend_analysis_tables.sql` の内容をコピー＆ペースト
5. 「実行」ボタンをクリック

#### MySQL Workbench の場合

1. MySQL Workbenchを起動
2. データベースに接続
3. クエリエディタを開く
4. `drizzle/0003_trend_analysis_tables.sql` の内容をコピー＆ペースト
5. 実行ボタン（⚡）をクリック

#### コマンドライン（MySQL CLI）の場合

```bash
# MySQLにログイン
mysql -u username -p database_name

# SQLファイルを実行
source drizzle/0003_trend_analysis_tables.sql

# または、直接実行
mysql -u username -p database_name < drizzle/0003_trend_analysis_tables.sql
```

---

### 方法2: プログラムから実行

既存の `scripts/seed-data.mjs` を参考に、マイグレーション実行スクリプトを作成済みです。

**注意**: まず依存関係をインストールする必要があります。

```bash
# 依存関係をインストール（--legacy-peer-depsオプション付き）
npm install --legacy-peer-deps

# その後、マイグレーション実行
node scripts/run-migration.mjs
```

---

## 📝 実行するSQL内容

以下の3つのテーブルが作成されます：

### 1. google_trend_data
Googleトレンドデータを保存するテーブル

### 2. twitter_trend_data
Twitterトレンドデータを保存するテーブル

### 3. daily_mood_judgment
日次判定結果（良い日/悪い日）を保存するテーブル

---

## ✅ 実行後の確認

マイグレーションが成功したら、以下のコマンドでテーブルが作成されたことを確認できます：

```sql
-- テーブル一覧を確認
SHOW TABLES;

-- 各テーブルの構造を確認
DESCRIBE google_trend_data;
DESCRIBE twitter_trend_data;
DESCRIBE daily_mood_judgment;
```

---

## 🚨 エラーが発生した場合

### エラー: "Table already exists"

既にテーブルが存在する場合、このエラーが表示されます。
- 問題ありません。既にテーブルが作成されているので、そのまま使用できます。

### エラー: "Access denied"

データベースへのアクセス権限がない場合。
- データベース管理者に権限を確認してください。

### エラー: "Database connection failed"

データベースに接続できない場合。
- `DATABASE_URL` 環境変数が正しく設定されているか確認してください。
- データベースサーバーが起動しているか確認してください。

---

## 📍 ファイルの場所

- **マイグレーションファイル**: `drizzle/0003_trend_analysis_tables.sql`
- **実行スクリプト**: `scripts/run-migration.mjs`（作成済み）

---

## 🎉 次のステップ

マイグレーション実行後：

1. ✅ テーブルが作成されたことを確認
2. ✅ サーバーを起動（`pnpm dev`）
3. ✅ APIをテストして動作確認

以上です！


