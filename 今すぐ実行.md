# 🚀 今すぐ実行！手順書

## 📋 現在の状況

✅ **実装完了** - 全てのコードは完成しています  
⏳ **マイグレーション待ち** - データベースにテーブルを作成する必要があります  
⏳ **動作確認待ち** - サーバーを起動してテストする必要があります

---

## 🎯 実行手順（3ステップ）

### ステップ1: マイグレーション実行 ⭐

**最も簡単な方法（推奨）:**

1. ファイルを開く: `drizzle/0003_trend_analysis_tables.sql`
2. SQL内容を全部コピー（3つのCREATE TABLE文）
3. データベース管理ツールで実行:
   - phpMyAdmin: SQLタブ → ペースト → 実行
   - MySQL Workbench: クエリエディタ → ペースト → 実行
   - コマンドライン: `mysql -u user -p database < drizzle/0003_trend_analysis_tables.sql`

**完了の確認:**
```sql
SHOW TABLES LIKE '%trend%';
SHOW TABLES LIKE '%mood%';
```
→ 3つのテーブル名が表示されればOK ✅

---

### ステップ2: サーバー起動

```bash
pnpm dev
# または
npm run dev
```

サーバーが `http://localhost:3000` で起動することを確認 ✅

---

### ステップ3: APIテスト

ブラウザの開発者ツール（F12）のConsoleで実行:

```javascript
fetch('/api/trpc/trends.getTodayMood')
  .then(r => r.json())
  .then(data => console.log('✅ 結果:', data))
  .catch(err => console.error('❌ エラー:', err));
```

**期待される結果:**
```json
{
  "result": {
    "data": {
      "success": true,
      "judgment": {
        "judgment": "good",
        "score": 0.45,
        ...
      }
    }
  }
}
```

→ この結果が返ってくれば成功 ✅

---

## 📁 実行するSQL（コピー用）

マイグレーションファイル: `drizzle/0003_trend_analysis_tables.sql`

または直接以下をコピー:

```sql
CREATE TABLE `google_trend_data` (
	`id` int AUTO_INCREMENT NOT NULL,
	`date` varchar(10) NOT NULL,
	`keyword` varchar(100) NOT NULL,
	`score` int,
	`region` varchar(10) DEFAULT 'JP',
	`category` varchar(50),
	`createdAt` timestamp NOT NULL DEFAULT (now()),
	CONSTRAINT `google_trend_data_id` PRIMARY KEY(`id`)
);

CREATE TABLE `twitter_trend_data` (
	`id` int AUTO_INCREMENT NOT NULL,
	`date` varchar(10) NOT NULL,
	`keyword` varchar(100) NOT NULL,
	`tweet_volume` int,
	`sentiment_score` varchar(20),
	`region` varchar(10) DEFAULT 'JP',
	`createdAt` timestamp NOT NULL DEFAULT (now()),
	CONSTRAINT `twitter_trend_data_id` PRIMARY KEY(`id`)
);

CREATE TABLE `daily_mood_judgment` (
	`id` int AUTO_INCREMENT NOT NULL,
	`date` varchar(10) NOT NULL,
	`judgment` varchar(20) NOT NULL,
	`score` varchar(20) NOT NULL,
	`google_score` varchar(20),
	`twitter_score` varchar(20),
	`space_weather_score` varchar(20),
	`confidence` varchar(20),
	`createdAt` timestamp NOT NULL DEFAULT (now()),
	`updatedAt` timestamp NOT NULL DEFAULT (now()) ON UPDATE CURRENT_TIMESTAMP,
	CONSTRAINT `daily_mood_judgment_id` PRIMARY KEY(`id`),
	CONSTRAINT `daily_mood_judgment_date_unique` UNIQUE(`date`)
);
```

---

## 🆘 エラーが出た場合

### "Table doesn't exist"
→ マイグレーションが未実行です。ステップ1を実行してください。

### "Cannot connect to database"
→ `DATABASE_URL` 環境変数を確認してください。

### APIが404を返す
→ サーバーが起動していないか、ルーティング設定を確認してください。

詳細は `動作確認手順.md` を参照。

---

## ✅ 完了チェックリスト

- [ ] マイグレーションSQLを実行した
- [ ] 3つのテーブルが作成されたことを確認した
- [ ] サーバーが起動した
- [ ] APIが正常に動作した
- [ ] 判定結果が返ってきた

**全てチェックがついたら完了です！** 🎉

---

## 📚 参考ドキュメント

- **詳細な動作確認**: `動作確認手順.md`
- **マイグレーション詳細**: `README_マイグレーション.md`
- **実装詳細**: `実装完了レポート.md`

---

**それでは、ステップ1から始めましょう！** 🚀

