# マイグレーションとは？

## 📖 簡単に言うと

**コードで定義したテーブル設計を、実際のデータベースに「作成」する作業**です。

---

## 🔍 詳しく説明

### 現在の状況

1. **コード側（schema.ts）**
   - 新しいテーブル3つの設計図がある
   - でも、まだデータベースには存在しない

2. **データベース側**
   - まだこれらのテーブルが存在しない
   - データを保存しようとするとエラーになる

### マイグレーションとは

- **マイグレーション = データベースの構造変更**
- テーブルを作成したり、カラムを追加したりする作業
- SQL文（CREATE TABLEなど）を実行する

---

## 📝 具体的な例

### コードで定義（schema.ts）

```typescript
export const googleTrendData = mysqlTable("google_trend_data", {
  id: int("id").autoincrement().primaryKey(),
  date: varchar("date", { length: 10 }).notNull(),
  keyword: varchar("keyword", { length: 100 }).notNull(),
  score: int("score"),
  // ...
});
```

### マイグレーションファイル（SQL）

```sql
CREATE TABLE `google_trend_data` (
  `id` int AUTO_INCREMENT NOT NULL,
  `date` varchar(10) NOT NULL,
  `keyword` varchar(100) NOT NULL,
  `score` int,
  -- ...
);
```

### 実行すると

データベースに `google_trend_data` というテーブルが実際に作成されます！

---

## 🎯 今回やること

### マイグレーションファイルは既に作成済み

`drizzle/0003_trend_analysis_tables.sql` に以下が含まれています：

1. `google_trend_data` テーブル作成
2. `twitter_trend_data` テーブル作成
3. `daily_mood_judgment` テーブル作成

### 実行方法

#### 方法1: drizzle-kitを使用（自動）

```bash
pnpm db:push
# または
npm run db:push
```

このコマンドが：
- スキーマを読み取る
- SQLを生成する
- データベースに実行する

#### 方法2: 手動でSQL実行

1. `drizzle/0003_trend_analysis_tables.sql` を開く
2. SQL文をコピー
3. データベース管理ツール（phpMyAdmin、MySQL Workbenchなど）で実行

---

## ⚠️ 重要ポイント

### なぜ必要？

- コードで定義しただけでは、データベースにはテーブルが存在しない
- テーブルがないと、データを保存できない
- アプリが動かない

### 実行前後

**実行前:**
- コード: ✅ テーブル定義あり
- データベース: ❌ テーブルなし
- 結果: エラー発生

**実行後:**
- コード: ✅ テーブル定義あり
- データベース: ✅ テーブルあり
- 結果: 正常動作 ✅

---

## 📚 補足：マイグレーションの役割

1. **テーブル作成** - 新しいテーブルを追加
2. **カラム追加** - 既存テーブルに列を追加
3. **カラム削除** - 不要な列を削除
4. **インデックス追加** - 検索速度を向上
5. **データ変換** - 既存データを移行

今回は「テーブル作成」を行います。

---

## 🎉 まとめ

**マイグレーション = コードの設計図をデータベースに反映させる作業**

- 設計図（schema.ts）→ 実際のテーブル（データベース）
- SQLファイルを実行するだけ
- 今回のファイル: `drizzle/0003_trend_analysis_tables.sql`

実行すれば、新しい機能（トレンド分析）が使えるようになります！

